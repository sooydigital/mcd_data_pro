{% extends 'base.html' %}
{% load static %} {% load permissions_tags %}
{% block headcontent %}
    <script src='https://cdn.plot.ly/plotly-2.17.1.min.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js'></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
{% endblock %}
{% block title %}
    Geo Mapa | MCD
{% endblock %}
{% block content %}
    <div id='myDiv_super_visor_map'><!-- Plotly chart will be drawn inside this DIV --></div>
{% endblock %}

{% block scriptcontent %}

    <script type="text/javascript">

        function pintarMapa(new_data) {
            puestos_votacion = new_data.puestos_votacion

            pv_lat = puestos_votacion.pv_lat
            pv_lon = puestos_votacion.pv_lon
            pv_text = puestos_votacion.pv_text
            pv_size = puestos_votacion.pv_size

            intensidad = new_data.intensidad

            in_lat = intensidad.in_lat
            in_lon = intensidad.in_lon
            in_text = intensidad.in_text
            in_size = intensidad.in_size

            var data = [
                {
                    "uid": "00e4ba",
                    "mode": "markers",
                    "name": "Intensidad",
                    "type": "scattermapbox",
                    "lat": in_lat,
                    "lon": in_lon,
                    "marker": {
                        "meta": {"columnNames": {"size": "Intensidad, size"}},
                        "sizeref": null,
                        "size": in_size
                    },
                    "text": in_text,
                    "visible": true,
                    "hoverinfo": "text+name"
                },
                {
                    "uid": "507651",
                    "mode": "markers",
                    "name": "Puesto de Votación",
                    "type": "scattermapbox",
                    "lat": pv_lat,
                    "lon": pv_lon,
                    "marker": {
                        "meta": {"columnNames": {"size": "Puesto de Votación, size"}},
                        "sizeref": null,
                        "size": pv_size
                    },
                    "text": pv_text,
                    "hoverinfo": "text+name"
                }
            ]

            var layout = {
                "title": {"text": "Geo Mapa"},
                "height": 550,
                "legend": {"x": 0, "y": 1},
                "mapbox": {
                    "zoom": 11,
                    "pitch": 2,
                    "center": {"lat": 7.070479, "lon": -73.106224},
                    "bearing": 0
                },
                "margin": {"b": 40, "l": 40, "r": 40, "t": 40},
                "autosize": true,
                "hovermode": "closest",
                "showlegend": true
            }
            var config = {
                "mapboxAccessToken": "pk.eyJ1IjoiY2hyaWRkeXAiLCJhIjoiY2lxMnVvdm5iMDA4dnhsbTQ5aHJzcGs0MyJ9.X9o_rzNLNesDxdra4neC_A"
            }

            Plotly.newPlot("myDiv_super_visor_map", data, layout, config = config);
        }

        new_data = {
            puestos_votacion: {
                pv_lat: ["Lattitude", "7.0609029", "7.0610946", "7.0721335", "7.0526437", "7.1128186"],
                pv_lon: ["Longitude", "-73.1719275", "-73.1711808", "-73.166756", "-73.1654239", "-73.1284499"],
                pv_text: ["", "Colegio Santa Cruz", "Colegio Juan Cristobal Martinez", "Colegio niño jesus de praga", "COLEGIO GABRIEL GARCIA MARQUEZ", "SENA - CSET - SEDE SAN JUAN DE DIOS"],
                pv_size: ["Size B", "10", "10", "10", "10", "10"]
            },
            intensidad: {
                in_lat: ["Lattitude", "7.0609029", "7.0610946", "7.0721335",  "7.0526437", "7.1128186"],
                in_lon: ["Longitude", "-73.1719275", "-73.1711808", "-73.166756", "-73.1654239", "-73.1284499"],
                in_text: ["Intensidad", "10", "5", "20", "2", "1"],
                in_size: ["Size E", "20", "15", "30", "12", "11"]
            }
        }
        pintarMapa(new_data)

    </script>
{% endblock %}