{% load static %} {% load permissions_tags %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <!-- FONT AWESOME -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- CSS -->
    <link rel="stylesheet" href="{% static 'css/style.css' %}">


  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.1/dist/jquery.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <link rel="icon" type="image/x-icon" href="{% static 'img/logo_mcd.JPG' %}">

    <script src='https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js'></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
    <title>Agregar Lider | MCD</title>
</head>


<body>
<div class="container-fluid px-2">
  <div class="card shadow-lg">
    <div class="card-header text-center principal_color">
      <h4 class="fw-bold my-2" style="color: white" >
        Crear Líder
      </h4>
    </div>

    <form method="POST" class="card-body px-3">
      {% csrf_token %}
      <div class="row row-cols-1 g-3">
        <!-- Documento -->
        <div>
          <label class="form-label">Cédula</label>
          <input type="number" class="form-control" name="document_id" placeholder="Número de identificación" required inputmode="numeric" id='input_document_id'>
        </div>

        <!-- Validación -->
        <div>
          <label class="form-label">Validación</label>
          <div id="status_validation" class="d-flex align-items-center gap-2">
            <div id="loaing_validation" class="spinner-border text-info" role="status">
              <span class="visually-hidden">Cargando...</span>
            </div>
            <i id="success_validation" class="fa fa-check-circle fa-2x verde_color_t invisible"></i>
            <i id="error_validation" class="fa fa-times-circle fa-2x red_color_t invisible"></i>
          </div>
          <div id="error_message_validation" class="text-danger small invisible">
            El número ya se encuentra registrado. Edita el perfil si es necesario.
          </div>
        </div>
        <!-- email -->
        <div>
          <label class="form-label">Correo Electrónico</label>
          <input type="text" class="form-control" name="email" placeholder="Correo Electrónico" required >
        </div>
        <!-- Nombre y Apellido -->
        <div>
          <label class="form-label">Nombre</label>
          <input type="text" class="form-control" name="first_name" placeholder="Nombre" required autocomplete="given-name">
        </div>

        <div>
          <label class="form-label">Apellido</label>
          <input type="text" class="form-control" name="last_name" placeholder="Apellido" required autocomplete="family-name">
        </div>

        <!-- WhatsApp -->
        <div>
          <label class="form-label">WhatsApp</label>
          <div class="input-group">
            <span class="input-group-text"><i class="fa fa-whatsapp"></i></span>
            <input type="tel" class="form-control" name="mobile_phone" placeholder="Número WhatsApp" required inputmode="tel">
          </div>
        </div>

        <!-- Fecha de nacimiento -->
        <div>
          <label class="form-label">Fecha de nacimiento</label>
          <div class="row g-2">
            <div class="col-4">
              <select name="day" class="form-select" required>
                {% for day in days %}
                  <option value="{{day}}">{{day}}</option>
                {% endfor %}
              </select>
            </div>
            <div class="col-4">
              <select name="month" class="form-select" required>
                {% for value,month in months %}
                  <option value="{{value}}">{{month}}</option>
                {% endfor %}
              </select>
            </div>
            <div class="col-4">
              <select name="year" class="form-select" required>
                <option value="">Año</option>
                {% for year in years %}
                    {% if year == '1990' %}
                        <option selected value="{{year}}">{{year}}</option>
                    {% else %}
                        <option value="{{year}}">{{year}}</option>
                    {% endif %}
                {% endfor %}
              </select>
            </div>
          </div>
        </div>

        <!-- Sexo -->
        <div>
          <label class="form-label">Sexo</label>
          <select class="form-select" name="gender" id="gender" required>
            <option value="">Seleccione...</option>
            <option value="MASCULINO">Masculino</option>
            <option value="FEMENINO">Femenino</option>
            <option value="OTRO">Otro</option>
          </select>
        </div>

        <!-- Municipio y Barrio -->
        <div>
          <label class="form-label">Municipio</label>
          <input type="text" class="form-control" name="municipio" placeholder="Municipio" autocomplete="address-level2">
        </div>
        <div>
            <label for="inputAddress" class="form-label">Comuna</label>
            <input type="text" class="form-control"  name="comuna" placeholder="Comuna">
        </div>
        <div>
          <label class="form-label">Barrio</label>
          <input type="text" class="form-control" name="barrio" placeholder="Barrio">
        </div>

        <!-- Dirección -->
        <div>
          <label class="form-label">Dirección</label>
          <input type="text" class="form-control" name="address" placeholder="Ej: Calle 12b #21-21" required autocomplete="street-address">
        </div>


        <div class="hidden">
          <label class="form-label">Etiqueta</label>
          <select name="etiqueta" class="form-select" required disabled>
              <option value="LIDER">Líder</option>
          </select>
        </div>


        <div>
          <label class="form-label">DESEA REALIZAR REUNION</label>
          <select name="add_question_desea_reunion" class="form-select" required>
            <option value="SI">Si</option>
            <option value="NO">NO</option>
          </select>
        </div>

        <div>
          <label class="form-label">DIA EN EL QUE DESEA REALIZAR SU REUNION</label>
          <select name="add_question_dia_reunion" class="form-select" required>
            <option value="LUNES">LUNES</option>
            <option value="MARTES">MARTES</option>
            <option value="MIERCOLES">MIERCOLES</option>
            <option value="JUEVES">JUEVES</option>
            <option value="VIERNES">VIERNES</option>
            <option value="SABADO">SABADO</option>
            <option value="DOMINGO">DOMINGO</option>
          </select>
        </div>

        <div>
          <label class="form-label">JORNADA EN LA CUAL DESEA REALIZAR SU REUNION</label>
          <select name="add_question_jornada_reunion" class="form-select" required>
            <option value="MAÑANA">MAÑANA (8AM A 12AM)</option>
            <option value="TARDE">TARDE (3PM A 6.00PM)</option>
            <option value="NOCHE">NOCHE (6PM A 9PM)</option>
          </select>
        </div>

        <div>
          <label class="form-label">CUANTAS MUJERES PUEDEN PARTICIPAR EN EL EVENTO DE MUJERES</label>
          <input type="number" class="form-control" name="add_question_cuantas_mujeres" required inputmode="numeric" >
        </div>


        <div>
          <label class="form-label">CUANTAS JOVENES PUEDEN PARTICIPAR EN EL EVENTO DE JOVENES</label>
          <input type="number" class="form-control" name="add_question_cuantos_jovenes" required inputmode="numeric">
        </div>

        <div>
          <label class="form-label">DESEA HACER PARTE DE LOS GRUPOS DE LA CAMPAÑA</label>
          <select name="add_question_parte_de_grupos" class="form-select" required>
            <option value="SI">Si</option>
            <option value="NO">NO</option>
          </select>
        </div>

        <div>
          <label class="form-label">EN QUE GRUPO DESEA PARTICIPAR</label>
          <select name="add_question_grupo_participar" class="form-select" required>
            <option value="AVANZADA">AVANZADA</option>
            <option value="LOGISTICA DE EVENTOS">LOGISTICA DE EVENTOS</option>
            <option value="ORADOR">ORADOR</option>
            <option value="ACOMPAÑAMIENTO">ACOMPAÑAMIENTO</option>
          </select>
        </div>

        <!-- Consentimiento -->
        <div class="form-check">
          <label class="form-check-label" for="flexCheckIndeterminate">
          Al hacer clic en 'Guardar', aceptas que podamos usar tus datos según la Ley 1581 de 2012 para almacenarlos, analizarlos y cuidarlos como lo exige la normativa de protección de datos.
          </label>
        </div>

        <!-- Botón Guardar -->
        <div class="text-center mt-4">
          <button type="submit" id="enviar_form" class="btn btn-lg btn-success w-100 disabled">Guardar</button>
        </div>
      </div>
    </form>
  </div>
</div>

</body>
<!--chart js-->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- BOOTSTRAP SCRIPTS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
<!-- BOOTSTRAP SCRIPTS END -->
<script type="text/javascript">
    // MODAL
    const myModal = document.getElementById('exampleModal')

    var DOM_IDS = {
        INPUT_DOCUMENT_ID: 'input_document_id',
        BTN_ENVIAR: "enviar_form",
    }

    window.addEventListener('load', function () {
        myModal.classList.add('show-modal')
    });


    function getBarriosByMunicipio(municipio, successCallback, errorCallback) {
        var url = `/api/get_barrio_by_municipio/${municipio}`
        $.ajax({
            type: 'GET',
            url,
            error: errorCallback,
            success: successCallback
        });
    }

    function checkValidationDocumentId(cc, successCallback, errorCallback) {
        var url = `/api/validate_cc/${cc}`
        $.ajax({
            type: 'GET',
            url,
            error: errorCallback,
            success: successCallback
        });
    }


    function actualizarValidacion(validation) {
        add_hidden_class("loaing_validation")
        if (validation) {
            add_hidden_class("error_validation")
            add_hidden_class("error_message_validation")
            remove_hidden_class("success_validation")
            $('#' + DOM_IDS.BTN_ENVIAR)[0].classList.remove('disabled')

        } else {
            add_hidden_class("success_validation")
            remove_hidden_class("error_validation")
            remove_hidden_class("error_message_validation")
            $('#' + DOM_IDS.BTN_ENVIAR)[0].classList.add('disabled')
        }
    }


    function validationDocumentIdSuccessCallback(data) {
        actualizarValidacion(data.data)
    }

    function validationDocumentIdErrorCallback() {
        console.log('validationDocumentIdErrorCallback, error validando la info del document ')

    }

    function add_hidden_class(id) {
        element = $("#" + id)[0]
        element.classList.add("invisible");
    }

    function remove_hidden_class(id) {
        element = $("#" + id)[0]
        element.classList.remove("invisible");
    }



    $("#" + DOM_IDS.INPUT_DOCUMENT_ID).on('change', function (e) {
        document_id = $('#' + DOM_IDS.INPUT_DOCUMENT_ID).val()
        remove_hidden_class("loaing_validation")
        add_hidden_class("success_validation")
        add_hidden_class("error_validation")
        add_hidden_class("error_message_validation")

        checkValidationDocumentId(document_id, validationDocumentIdSuccessCallback, validationDocumentIdErrorCallback)
    });



    populate_barrios()




</script>

</html>